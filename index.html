<html>
	<script src = ></script>

	<body>
		<div id="content"></div>
		<div id="nextbutton">
			<button onClick="nextSlide()"> next page </button>
		</div>
	</body>
	<head>	
		<style type="text/css">
			#content{
			    text-align: center;
			    background: lightgray;
			    height: 100%;
			    padding: 30px;
			}
			#nextbutton{
			    position: absolute;
			    right: 5%;
			    top: 50%;
			}
			#nextbutton button{
			    font-size: 30;
			    padding: 0 20;
			}
			input {
   			 	margin: 0 20;
			}
			input[type=checkbox]{
				width: 30px;
				height: 30px;
			}
			.mainimg{
				height: 80%;
			}
		</style>

		<script type="text/javascript" src="./lib/jquery.js"></script>
		<script src = "./js/lfunctionhub.js"></script>
		<!-- <script type="text/javascript" src="./lib/lurlquery.js"></script> -->
        <script type="text/javascript" src = "./js/functionhub.js"></script>

		<script>
			var timestart,timeend,interval
			var g_functionhub = new FunctionHub()

			var question1 = {
				"question": "How many clusters in the scatterplot?",
				"questionname": "clusternumber",
				"optiongroups": [1,2,3],
			}

			var question2 = {
				"question": "Which cluster has larger average certainty, cluster 1 or cluster 2?",
				"questionname": "clusternumber",
				"optiongroups": [1,2],
			}

			var question3 = {
				"question": "How many clusters in the scatterplot?",
				"questionname": "clusternumber",
				"optiongroups": [1,2,3,4],
			}

			var question4 = {
				"question": "Which cluster has larger average certainty, cluster 1 or cluster 2?",
				"questionname": "larger average", 
				"optiongroups": [1,2],
			}

			
			var questionMap = {
				4: question1, 6: question2, 
				8: question3, 10: question4,
			}

		</script>

		<script>
			loadImgTime = function(){
                timestart = new Date()
            }

            nextButtonTime = function(){
                console.log("timestart", timestart)
                timeend = new Date();
                var intervalms = (timeend - timestart);
                var days = Math.floor(intervalms/(24*3600*1000))
                
                var level1 = intervalms%(24*3600*1000)
                var hours = Math.floor(level1/(3600*1000))

                var level2 = intervalms%(3600*1000)
                var minutes = Math.floor(level2/(60*1000))

                var level3 = intervalms%(60*1000)
                var seconds = Math.round(level3/1000)

                var level4 = intervalms%1000
                var seconds2 = Math.round(level4/10) / 100



                interval = hours * 3600 + minutes*60 + seconds + seconds2
                console.log("timeend", timeend)
                console.log("interval",interval)
                timestart = timeend
            }

            answerSubmit = function(imgIndex){
                nextButtonTime();
                var self = this;
                this._answer = $('input:radio[name="answer"]:checked').val();
                this._question = $('#question').text()
                this._imgname = imgIndex.toString().concat(".png")
                var formData = new FormData()
                formData.append('question',this._question)
                formData.append('answer',this._answer)
                formData.append('answerinterval',interval)
                formData.append('imgname', this._imgname)
                var url = "http://localhost:22030/saveanswerinfo"
                lSendUrl("POST", url, formData, self.successSaveAnswer)

            }

            successSaveAnswer = function(response, self){
                console.log("save answer ok")
            }

		</script>

		<script type="text/javascript">

			g_slide = 1;
			$('#content')[0].innerHTML = getPageContent(g_slide)//'hello page#' + g_slide
			// }

			function nextSlide(){
				var g_option =  document.getElementById("optionContent")
				var questionintro = document.getElementById("questionintro")

				if(g_slide == 2){
					g_functionhub.submit()
				}

				if(g_slide >= 3 && questionintro != undefined){
					loadImgTime()
				}

				if(g_slide >= 4 && g_option != undefined){
					answerSubmit(g_slide)
				}

				g_slide += 1

				$('#content')[0].innerHTML = getPageContent(g_slide);
				
				// var formData = new FormData()
				// formData.append('slideIndex', g_slide)
				// lSendUrl('POST', 'http://localhost:22030/slide', formData, 
				// 	function(response){
				// 		console.log('success get slide', response['slideIndex']);
				// 		g_slide = response['slideIndex'];
				// 		$('#content')[0].innerHTML = getPageContent(g_slide);
				// })
			}
			function getPageContent(slideIndex){
				switch(slideIndex){
					case 1:  //welcome slide
						return getTextPage('welcome : )')
					case 2: //user info
						return getUserInfoForm();
						break;
					case 3: //scatterplot welcome
					case 5:
					case 7:
					case 9:
						var questionContent = questionMap[slideIndex+1]["question"]
						return getTextPage(questionContent, true)
					case 4:
					case 6:
					case 8:
					case 10:
						var imgContent = getImgContent(slideIndex);
						var questionContent = getQuestionContent(questionMap[slideIndex]["question"]);
						var optionContent = getOptionContent(questionMap[slideIndex])
						return imgContent + questionContent + optionContent;
					default:
						return getTextPage('Continue...', false)
				}
			}
			function getTextPage(text,isQuestionIntro){
				if(isQuestionIntro){
					return '<h1 id = "questionintro">' + text + '</h1>'
				}
				else{
					return '<h1>' + text + '</h1>'
				}
			}
			function getUserInfoForm(){
				// return '<h1>Age<input id="age"></input></h1><br>' +
				// 	   '<h1>Gender<input type="checkbox">Female</input>' + 
				// 	   '<input type="checkbox">Male</input></h1><br>'
				return '<form method="post" action="">' +
                			'<table border="1" bordercolor= "steerblue" cellpadding="10px" cellspacing="0">'+
                    			'<caption>Questionare</caption> '+
			                 	'<tbody>'+
			                        '<tr>'+
			                            '<td>Age: </td>'+
			                            '<td><input type = "text" name = "age"></input></td>'+
			                        '</tr>'+
			                        '<tr><td>Gender: </td><td><input type = "radio" name = "gender" value="F" checked="checked">Woman<input type = "radio" name = "gender" value = "M">Man</td></tr>'+
			                        '<tr><td>Science/Engineering</td><td><input type = "radio" name = "studyinterest" value = "Humanities and Social sciences" checked="checked">Humanities and Social sciences<input type = "radio" name = "studyinterest" value = "Others">Others</td></tr>'+
			                        '<tr><td>Academic Level</td><td><input type = "radio" name = "academiclevel" value = "Undergraduate" checked="checked">Undergraduate<input type = "radio" name = "academiclevel" value = "Post graduate (MSc, PhD)">Post graduate (MSc, PhD)<input type = "radio" name = "academiclevel" value = "Other">Other</td></tr>'+
			                        '<tr>'+
			                            '<td>Assess your experience in Data Visualization</td>'+
			                            '<td>'+
			                                '<input type = "radio" name = "experience" value = "None" checked="checked">None'+
			                                '<input type = "radio" name = "experience" value = "Little">Little'+
			                                '<input type = "radio" name = "experience" value = "Medium or pretty good">Medium or pretty good'+
			                                '<input type = "radio" name = "experience" value = "Very good">Very good'+
			                            '</td>'+
			                        '</tr>'+
			                    '</tbody>'+
			                '</table>'+
			                // '<input id = "submitbutton" type = "submit" name = "submit" value="submit" onclick >'+
			            '</form>'
			}
			function getImgContent(imgIndex){
				console.log('<img src=' + '"./rc/img_'+ (imgIndex) + '"' + '/>');
				return '<div>' + 
					   '<img class="mainimg" src=' + '"./rc/img_'+ (imgIndex) + '.png"' + '/>'
					   '</div>' 
			}
			function getQuestionContent(questionText){
				return '<div id = "question">' + questionText +
					   '</div>'
			}
			function getOptionContent(questionInfo){
				var questionname = questionInfo["questionname"]
				var lioptiongroups = questionInfo["optiongroups"]
				console.log("lioptiongroups", lioptiongroups)
				var optionContent = ""

				for (var j in lioptiongroups){
					console.log("j", j)
					if(j == 0){
						var input = '<input type = "radio" name = "answer" ' + 
					  	' value = " ' + lioptiongroups[j] + ' " ' +
					  	' checked = "checked">'+lioptiongroups[j] 
					  	optionContent = input;
					  	console.log("1111111111111")
					}
					else{
						var input = '<input type = "radio" name =  "answer" ' +
					  	' value = " ' + lioptiongroups[j] + ' ">'+lioptiongroups[j] 
					  	optionContent = optionContent.concat(input);
					  	console.log("222222222222222")
					}
					
				}
				console.log("optionContent", optionContent)
				return '<div id = "optionContent">' + optionContent + '</div>'
			}
		</script>

		
	</head>
</html>
